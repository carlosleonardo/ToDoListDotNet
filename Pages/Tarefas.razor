@page "/tarefas"
@* @inject ServicoToDo servicoToDo *@

<PageTitle>Tarefas</PageTitle>

<ManterTarefa @ref="meuModal" Titulo="Adicionar Tarefa" Tarefa="Tarefa"/>

<div class="container-fluid p-3">
    <h1>Tarefas</h1>
    <button class="btn btn-primary" @onclick="AbrirDialogo">Adicionar</button>
</div>


<div class="container-fluid">
    <div class="card p-3">
        <table class="table table-striped" >
            <tr>
                <th>Id da tarefa</th>
                <th>Nome</th>
                <th>Descrição</th>
                <th>Finalizada</th>
                <th>Data início</th>
                <th>Data Término</th>
            </tr>
            
            @if(tarefas is null || tarefas.Count()==0) {
                <tr><td>Sem Tarefas</td></tr>
            } else {
                foreach(var tarefa in tarefas)
                {
                    <td >@tarefa.Id</td>
                    <td >@tarefa.Nome </td>
                    <td >@tarefa.Descricao </td>
                    <td >@(tarefa.Finalizada ? "Sim": "Não") </td>
                    <td>@tarefa.DataInicio </td>
                    <td>@tarefa.DataTermino</td>
                    <td>
                        <button class="btn btn-close" disabled="@tarefa.Finalizada" ></button>
                        <button class="btn btn-primary" disabled="@tarefa.Finalizada" >Alterar</button>
                        <button class="btn btn-primary" disabled="@tarefa.Finalizada" >Finalizar</button>
                    </td>

                }
            }
            @* <tr *ngFor="let tarefa of tarefas" >
                
            </tr> *@
        </table>
    </div>
</div>

@code {
    private ManterTarefa meuModal;

    private IList<Tarefa> tarefas = new List<Tarefa>();

    public Tarefa? Tarefa { get; set; }

    protected override async Task OnInitializedAsync()
    {
        Tarefa = new() { DataInicio = DateTime.Now };
        await ObterTarefas();
    }

    public async Task ObterTarefas()
    {
        //tarefas = await servicoToDo.ObterTarefas();
    }

    private async Task AbrirDialogo()
    {
        meuModal.Titulo = "Adicionar Tarefa";
        await meuModal.AbrirDialogo();    
    }   
}